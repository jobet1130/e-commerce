# =====================================
# Prisma Migration Image
# =====================================
FROM node:20-alpine

WORKDIR /app

# Install dependencies first (for better caching)
COPY package.json package-lock.json ./
RUN npm ci --only=production

# Copy Prisma schema
COPY prisma ./prisma/

# Install Prisma CLI
RUN npm install -g prisma

# Generate Prisma Client
RUN npx prisma generate

# Set entrypoint for migrations
ENTRYPOINT ["npx", "prisma", "migrate", "deploy"]

# Default command (can be overridden)
CMD ["--help"]
